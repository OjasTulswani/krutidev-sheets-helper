<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: sans-serif;
        margin: 10px;
        background-color: #f8f9fa;
        color: #3c4043;
      }
      h3 {
        color: #1a73e8;
        border-bottom: 1px solid #dadce0;
        padding-bottom: 8px;
        margin-bottom: 15px;
      }
      button {
        padding: 10px 18px;
        background-color: #1a73e8; /* Google Blue */
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin-bottom: 8px;
        width: 100%;
        box-shadow: 0 2px 2px 0 rgba(0,0,0,0.1);
        transition: background-color 0.2s ease, box-shadow 0.2s ease;
      }
      button:hover {
        background-color: #1764cc; /* Darker blue on hover */
        box-shadow: 0 3px 3px 0 rgba(0,0,0,0.15);
      }
      button:disabled {
        background-color: #a0c3f0;
        cursor: not-allowed;
      }
      .separator {
        border-top: 1px solid #dadce0;
        margin: 20px 0;
      }
      .message {
        margin-top: 15px;
        padding: 10px;
        background-color: #e6f4ea; /* Light green for success */
        border: 1px solid #34a853;
        border-radius: 4px;
        color: #1e8e3e;
        display: none; /* Hidden by default */
      }
      .error {
        background-color: #fce8e6; /* Light red for error */
        border: 1px solid #ea4335;
        color: #b31412;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      textarea {
        width: calc(100% - 20px);
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #dadce0;
        border-radius: 4px;
        resize: vertical;
        min-height: 80px;
      }
      .form-group {
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <h3>Kruti Dev & Hindi Helper</h3>
    <p>Convert selected cells, or type directly for conversion.</p>

    <div class="form-group">
      <label for="krutiDevInput">Type Kruti Dev here:</label>
      <textarea id="krutiDevInput" placeholder="Type Kruti Dev text..."></textarea>
      <button onclick="convertTypedKrutiDev()">Convert to Unicode</button>
      <label for="unicodeOutput">Unicode Output:</label>
      <textarea id="unicodeOutput" readonly></textarea>
    </div>

    <div class="form-group">
      <label for="unicodeInput">Type Unicode here:</label>
      <textarea id="unicodeInput" placeholder="Type Unicode text..."></textarea>
      <button onclick="convertTypedUnicode()">Convert to Kruti Dev</button>
      <label for="krutiDevOutput">Kruti Dev Output:</label>
      <textarea id="krutiDevOutput" readonly></textarea>
    </div>

    <div class="separator"></div>

    <h4>Sheet Actions</h4>
    <button onclick="convertSelectedToUnicode()">Convert Selected to Unicode</button>
    <button onclick="convertSelectedToKrutiDev()">Convert Selected to Kruti Dev</button>

    <div class="separator"></div>

    <h4>File Actions</h4>
    <button onclick="downloadKrutiDevCSV()">Download as Kruti Dev CSV</button>
    <button onclick="printCurrentSheet()">Print Sheet (as current view)</button>

    <div id="messageArea" class="message"></div>

    <script>
      function showMessage(msg, isError = false) {
        const messageArea = document.getElementById('messageArea');
        messageArea.textContent = msg;
        messageArea.style.display = 'block';
        if (isError) {
          messageArea.classList.add('error');
          messageArea.classList.remove('success');
        } else {
          messageArea.classList.add('success');
          messageArea.classList.remove('error');
        }
        setTimeout(() => { messageArea.style.display = 'none'; }, 5000); // Hide after 5 seconds
      }

      function disableAllButtons(disable) {
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
          button.disabled = disable;
        });
      }

      // --- Typed Input Conversions ---
      function convertTypedKrutiDev() {
        disableAllButtons(true);
        const krutiDevText = document.getElementById('krutiDevInput').value;
        google.script.run
          .withSuccessHandler(function(unicodeResult) {
            document.getElementById('unicodeOutput').value = unicodeResult;
            showMessage('Text converted to Unicode.');
            disableAllButtons(false);
          })
          .withFailureHandler(function(error) {
            showMessage('Error converting text: ' + error.message, true);
            disableAllButtons(false);
          })
          .krutiDevToUnicode(krutiDevText);
      }

      function convertTypedUnicode() {
        disableAllButtons(true);
        const unicodeText = document.getElementById('unicodeInput').value;
        google.script.run
          .withSuccessHandler(function(krutiDevResult) {
            document.getElementById('krutiDevOutput').value = krutiDevResult;
            showMessage('Text converted to Kruti Dev.');
            disableAllButtons(false);
          })
          .withFailureHandler(function(error) {
            showMessage('Error converting text: ' + error.message, true);
            disableAllButtons(false);
          })
          .unicodeToKrutiDev(unicodeText);
      }


      // --- Sheet Selection Conversions ---
      function convertSelectedToUnicode() {
        disableAllButtons(true);
        google.script.run
          .withSuccessHandler(function(result) {
            showMessage(result);
            disableAllButtons(false);
          })
          .withFailureHandler(function(error) {
            showMessage('Error converting selection: ' + error.message, true);
            disableAllButtons(false);
          })
          .convertSelectionToUnicode();
      }

      function convertSelectedToKrutiDev() {
        disableAllButtons(true);
        google.script.run
          .withSuccessHandler(function(result) {
            showMessage(result);
            disableAllButtons(false);
          })
          .withFailureHandler(function(error) {
            showMessage('Error converting selection: ' + error.message, true);
            disableAllButtons(false);
          })
          .convertSelectionToKrutiDev();
      }

      // --- Download and Print ---
      function downloadKrutiDevCSV() {
        disableAllButtons(true);
        google.script.run
          .withSuccessHandler(function(csvContent) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `KrutiDev_Data_${new Date().getTime()}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showMessage('CSV downloaded successfully.');
            disableAllButtons(false);
          })
          .withFailureHandler(function(error) {
            showMessage('Error downloading CSV: ' + error.message, true);
            disableAllButtons(false);
          })
          .downloadAsKrutiDevCSV();
      }

      function printCurrentSheet() {
        disableAllButtons(true);
        google.script.run
          .withSuccessHandler(function() {
            // The print dialog will open directly from the server-side script
            // No need for a message here, as the user will see the print dialog.
            showMessage('Opening print dialog...');
            disableAllButtons(false);
          })
          .withFailureHandler(function(error) {
            showMessage('Error opening print dialog: ' + error.message, true);
            disableAllButtons(false);
          })
          .printSheet();
      }
    </script>
  </body>
</html>
